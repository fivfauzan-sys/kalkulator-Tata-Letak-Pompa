<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kalkulator Pompa Pro - Final Audit Version</title>
    <style>
        :root { --primary: #1a73e8; --danger: #d93025; --success: #1e8e3e; --warning: #f9ab00; }
        body { font-family: 'Segoe UI', system-ui, sans-serif; padding: 20px; background: #f8f9fa; color: #202124; }
        .container { max-width: 1100px; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.12); margin: auto; }
        h2 { text-align: center; color: var(--primary); margin-bottom: 30px; border-bottom: 2px solid #eee; padding-bottom: 10px; }
        .tabs { display: flex; justify-content: center; margin-bottom: 25px; gap: 10px; }
        .tab { padding: 12px 30px; cursor: pointer; border: 2px solid var(--primary); background: white; color: var(--primary); font-weight: 600; border-radius: 50px; transition: 0.2s; }
        .tab.active { background: var(--primary); color: white; }
        .section-title { background: #e8f0fe; color: var(--primary); padding: 10px 15px; border-radius: 6px; margin: 25px 0 15px 0; font-weight: bold; font-size: 0.9em; display: flex; align-items: center; justify-content: space-between; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px; margin-bottom: 20px; }
        label { display: block; font-weight: 600; font-size: 0.85em; margin-bottom: 8px; color: #5f6368; }
        input, select { width: 100%; padding: 12px; border: 1px solid #dadce0; border-radius: 8px; box-sizing: border-box; font-size: 14px; }
        input:focus { border-color: var(--primary); outline: none; box-shadow: 0 0 0 2px rgba(26,115,232,0.2); }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 0.85em; }
        th, td { padding: 12px; border: 1px solid #f1f3f4; text-align: center; }
        th { background: #f8f9fa; font-weight: 600; }
        .result-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 30px; }
        .card { padding: 20px; border-radius: 12px; border: 1px solid #dadce0; background: #fff; }
        .highlight { font-size: 1.8em; font-weight: 700; color: var(--primary); display: block; margin: 10px 0; }
        .status-badge { padding: 6px 12px; border-radius: 6px; font-weight: bold; font-size: 0.85em; display: inline-block; }
        .safe { background: #e6f4ea; color: var(--success); }
        .warning { background: #fef7e0; color: #b06000; }
        .danger { background: #fce8e6; color: var(--danger); }
        .recommendation { margin-top: 15px; padding: 10px; border-left: 4px solid var(--warning); background: #fff8e1; font-size: 0.85em; }
    </style>
</head>
<body>

<div class="container">
    <h2>üè¢ System Engineering Pump Calculator</h2>
    
    <div class="tabs">
        <button id="tab-sub" class="tab active" onclick="setMode('submersible')">SUBMERSIBLE</button>
        <button id="tab-dry" class="tab" onclick="setMode('dry')">DRY PUMP (NPSHa)</button>
    </div>

    <div class="section-title"><span>‚öôÔ∏è DATA INPUT UTAMA</span></div>
    <div class="grid">
        <div><label>Debit Aliran (LPS):</label><input type="number" id="q_lps" value="250" oninput="calculate()"></div>
        <div><label>Diameter Pipa Suction (m):</label><input type="number" id="d_m" value="0.6" step="0.01" oninput="calculate()"></div>
        <div>
            <label>Material Pipa (Hazen-Williams C):</label>
            <select id="c_material" onchange="calculate()">
                <option value="150">HDPE / PVC (C=150)</option>
                <option value="100">Steel / GI (C=100)</option>
                <option value="83">Cast Iron (C=83)</option>
                <option value="120">Concrete (C=120)</option>
            </select>
        </div>
    </div>

    <div id="ui-submersible">
        <div class="section-title"><span>üåä PARAMETER SUMUR (WET PIT)</span></div>
        <div class="grid">
            <div><label>Min. LWL Katalog (m):</label><input type="number" id="lwl_cat" value="1.2" oninput="calculate()"></div>
            <div><label>Min. Jarak Dasar (CL) (m):</label><input type="number" id="cl_cat" value="0.3" oninput="calculate()"></div>
        </div>
    </div>

    <div id="ui-dry" style="display:none;">
        <div class="section-title"><span>üìç ELEVASI & LINGKUNGAN</span></div>
        <div class="grid">
            <div><label>EL. LWL (m):</label><input type="number" id="el_lwl" value="50.00" oninput="calculate()"></div>
            <div><label>EL. As Outlet Suction (m):</label><input type="number" id="el_as" value="79.09" oninput="calculate()"></div>
            <div><label>Hs (Atmosfer) (m):</label><input type="number" id="hs_m" value="11.03" oninput="calculate()"></div>
            <div><label>Hvp (Vapor Press) (m):</label><input type="number" id="hvp_m" value="0.32" oninput="calculate()"></div>
            <div><label>Panjang Pipa Lurus (m):</label><input type="number" id="l_m" value="10" oninput="calculate()"></div>
            <div><label>NPSHr Katalog (m):</label><input type="number" id="npshr" value="4.0" oninput="calculate()"></div>
        </div>

        <div class="section-title"><span>üîß FITTING LOSSES (K-FACTOR)</span></div>
        <table>
            <thead><tr><th>Fitting Item</th><th>Nilai K</th><th>Qty</th><th>Total K</th></tr></thead>
            <tbody id="fitting-body"></tbody>
        </table>
    </div>

    <div id="results" class="result-container"></div>
</div>

<script>
let mode = 'submersible';
const fittings = [
    { name: 'Entrance', k: 0.5, qty: 1 },
    { name: 'Check Valve', k: 2.0, qty: 1 },
    { name: 'Elbow 90¬∞', k: 0.3, qty: 2 },
    { name: 'Flange/Joint', k: 0.04, qty: 4 }
];

function setMode(m) {
    mode = m;
    document.getElementById('tab-sub').classList.toggle('active', mode === 'submersible');
    document.getElementById('tab-dry').classList.toggle('active', mode === 'dry');
    document.getElementById('ui-submersible').style.display = mode === 'submersible' ? 'block' : 'none';
    document.getElementById('ui-dry').style.display = mode === 'dry' ? 'block' : 'none';
    calculate();
}

function renderFitting() {
    document.getElementById('fitting-body').innerHTML = fittings.map((f, i) => `
        <tr>
            <td>${f.name}</td>
            <td><input type="number" step="0.01" value="${f.k}" oninput="fittings[${i}].k=parseFloat(this.value);calculate()"></td>
            <td><input type="number" value="${f.qty}" oninput="fittings[${i}].qty=parseInt(this.value);calculate()"></td>
            <td>${(f.k * f.qty).toFixed(2)}</td>
        </tr>
    `).join('');
}

function calculate() {
    const q_lps = parseFloat(document.getElementById('q_lps').value) || 0;
    const q = q_lps / 1000;
    const d = parseFloat(document.getElementById('d_m').value) || 0.1;
    const g = 9.81;
    const v = q / (0.25 * Math.PI * Math.pow(d, 2));

    // Audit Kecepatan
    let vClass = v > 2.0 ? 'danger' : (v > 1.5 ? 'warning' : 'safe');
    let vText = v > 2.0 ? 'Terlalu Tinggi' : (v > 1.5 ? 'Tinggi (Cek Losses)' : 'Ideal');
    let recD = Math.sqrt(q / (0.25 * Math.PI * 1.5));

    let html = `
        <div class="card">
            <label>KECEPATAN ALIRAN (v)</label>
            <span class="highlight">${v.toFixed(2)} m/s</span>
            <span class="status-badge ${vClass}">${vText}</span>
            ${v > 1.5 ? `<div class="recommendation">üí° Saran: Gunakan diameter min. <b>${(recD*1000).toFixed(0)} mm</b> untuk menurunkan kecepatan ke 1.5 m/s.</div>` : ''}
        </div>`;

    if (mode === 'submersible') {
        const s = d * (1 + (2.3 * (v / Math.sqrt(g * d))));
        const c = Math.max(0.57 * d, parseFloat(document.getElementById('cl_cat').value));
        const lwl = Math.max(s + c, parseFloat(document.getElementById('lwl_cat').value));

        html += `
            <div class="card">
                <label>HASIL LAYOUT SUBMERSIBLE</label>
                <span class="highlight">LWL: ${lwl.toFixed(2)} m</span>
                <p style="font-size:0.85em; color:#555;">
                    - Jarak Dasar (C): ${c.toFixed(2)} m<br>
                    - Submergence (S): ${s.toFixed(2)} m<br>
                    - Jarak Dinding: ${(0.75*d).toFixed(2)} m
                </p>
            </div>`;
    } else {
        const el_lwl = parseFloat(document.getElementById('el_lwl').value) || 0;
        const el_as = parseFloat(document.getElementById('el_as').value) || 0;
        const z = el_lwl - el_as;
        const hs = parseFloat(document.getElementById('hs_m').value);
        const hvp = parseFloat(document.getElementById('hvp_m').value);
        const l = parseFloat(document.getElementById('l_m').value);
        const npshr = parseFloat(document.getElementById('npshr').value);
        const c_hw = parseFloat(document.getElementById('c_material').value);

        const hf_maj = 10.67 * (Math.pow(q, 1.852) / (Math.pow(c_hw, 1.852) * Math.pow(d, 4.87))) * l;
        const kt = fittings.reduce((acc, f) => acc + (f.k * (f.qty || 0)), 0);
        const hf_min = kt * (v * v / (2 * g));
        const total_hf = hf_maj + hf_min;
        const npsha = hs - hvp - total_hf + z;

        html += `
            <div class="card">
                <label>ANALISIS NPSH AVAILABLE</label>
                <span class="highlight" style="color:${npsha > npshr ? 'var(--success)' : 'var(--danger)'}">${npsha.toFixed(2)} m</span>
                <span class="status-badge ${npsha > npshr ? 'safe' : 'danger'}">${npsha > npshr ? 'AMAN' : 'BAHAYA KAVITASI'}</span>
                <p style="font-size:0.8em; color:#666; margin-top:10px; border-top:1px solid #eee; pt:10px;">
                    <b>Audit Losses:</b><br>
                    Mayor (Pipe): ${hf_maj.toFixed(4)} m<br>
                    Minor (Fitting): ${hf_min.toFixed(4)} m<br>
                    Z Elevation: ${z.toFixed(2)} m
                </p>
            </div>`;
    }
    document.getElementById('results').innerHTML = html;
}

renderFitting();
calculate();
</script>
</body>
</html>